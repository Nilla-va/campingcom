
드디어 배포하기! :
내 앱을 배포하기 위해 무료 호스팅서비스를 이용해보자.
여러 앱 호스팅 서비스들 중
강의에서는 원래 Heroku 썼었는데 유료로 바뀌어서 대안으로 Render 사용하도록 아래처럼 안내받음.


-----------------------------

[Heroku]


가입하고 설치
터미널에서 로그인 - heroku login
헤로쿠에 내앱올릴 공간및url 생성 - 프젝디렉토리에서(꼭!) heroku create
화면에 뜬 url로 접속해보면 공간은 만들어져있지만 일단은 제네릭메시지만 뜸

숨겨야할 데이터들 .env로 다 옮기기 (세션secret, API크레덴셜들, DB접속비번 등등)
.gitignore에 node_modules와 .env 추가
(참고: git remote -v 해보면 내 프젝과 연결된 heroku원격저장소 주소 나옴)
git add .
git commit -m "ready to try deploying..."
git push heroku master (패키지 설치하고 빌드하느라 꽤 걸림)
(참고: 에러 등 로그 보려면 heroku logs --tail)

아까 그 url 새로고침해보면 오류뜨는데, start 스크립트가 누락되어서라고 프젝터미널에 뜸
package.json의 "scripts": 안에 "start": "node app.js" 추가
"name": 에 있는 프젝이름이 전부 소문자 맞는지도 확인
프젝터미널에 npm start 해서 제대로 실행되는지 확인
heroku에서 쓰는 포트번호는 process.env.PORT 이걸로 불러올수있기때문에
app.js에 const port = process.env.PORT || 3000; 이 코드 추가하고 3000 대신 port 넣기
내 프로젝트코드에 변동이 생겼으므로 git add/commit/push 다시 해줌

아까 그 url 새로고침해보면 또 오류뜨는데, 이번엔 토큰없이는 클라이언트 생성 못한다고 뜸
헤로쿠홈피 내앱설정페이지에서 config vars 란에 내 환경변수들 다 입력하기
(또는 터미널에서 heroku config:set 환경변수명=변수값 이렇게 해도 홈피설정페이지에서 확인됨)

혹시 몽고아틀라스 때문에 또 오류뜨면 몽고아틀라스가 헤로쿠 접근을 막아서일거임
몽고설정에서 ALLOW ACCESS FROM ANYWHERE 해서 어느IP에서도 몽고에 접근할수있게 해주기
그리고 재실행해보기 - heroku restart


[Render]


여러분 안녕하세요!

다음 강의 영상에서는 앱 호스팅 서비스로 Heroku를 사용하여 YelpCamp 애플리케이션을 온라인으로 배포하고 게시합니다. 그러나 Heroku는 2022년 11월 28일부터 앱 배포 서비스에 대한 무료 요금제 제공을 중단했습니다. 현재 Heroku에서 앱을 배포하려면 유료 요금제를 사용해야 합니다. 비교적 저렴한 에코 요금제를 제공하지만, 이 요금제를 사용하려면 청구를 설정하기 위한 유효한 온라인 결제 카드가 있어야 합니다. 이 과정을 학습하는 동안 YelpCamp 앱을 호스팅할 수 있는 무료 솔루션을 찾기 위해 몇 가지 대안을 조사한 결과 Render라는 앱 호스팅 서비스를 발견했습니다 — https://render.com/

따라서 앱 배포를 위해 Heroku의 무료 대안을 원하는 경우 Render를 사용할 수 있습니다.
Render가 제공하는 무료 티어에 대한 자세한 내용은 여기에서 확인할 수 있습니다.
https://docs.render.com/free#free-web-services

이 과정에서 만든 YelpCamp 애플리케이션의 최종 버전을 배포하여 Render의 무료 서비스를 테스트해보았습니다.
(최종 버전은 여기 배포하기 섹션의 첫 번째 강의에서 공유한 강의자료 링크에서 다운로드할 수 있습니다.)
이를 바탕으로 Render를 통해 YelpCamp 앱을 배포하는 지침을 작성했습니다.


# 1.

먼저 웹사이트(render.com)를 통해 Render에 계정을 생성해야 합니다.
GitHub 계정을 사용하여 Render에 등록하는 경우 이후 단계에서 계정을 연결할 필요가 없습니다.
(앱을 GitHub에 업로드하면 Render가 이를 사용하여 앱을 배포합니다.)

Render의 노드 배포 지침 설명서: https://render.com/docs/deploy-node-express-app


# 2.

Render에서 배포 프로세스를 계속 진행하기 전에 모든 사전 단계를 완벽하게 준비해야 합니다. 즉, Heroku 배포 강의 이전의 모든 강의를 수강하고, 모든 YelpCamp 코드를 올바르게 설정하고 최신 상태로 유지해야 하며, 중요한 것은 이전 MongoDB Atlas 설정하기 강의(강의 커리큘럼의 배포 섹션 시작부터)를 따라 Render에 앱을 배포할 때 사용할 온라인 호스팅 MongoDB 데이터베이스 서버를 설정해야 한다는 것입니다.

필요한 경우 여기에서 Colt의 최종 버전의 YelpCamp 코드를 확인할 수 있으며, 여기에서 온라인 MongoDB Atlas 데이터베이스 설정을 시작할 수 있는 강의 링크를 찾을 수 있습니다. MongoDB Atlas 강의를 완전히 숙지하고 앱에 사용할 데이터베이스 링크를 준비하세요!

중요: 이 시점에서 애플리케이션을 배포할 때 노드 버전 문제가 발생하지 않도록 package.json 파일에 Node.js 버전 18을 지정해야 합니다. 아래 안내에 따라 Render가 앱에 사용할 프로젝트의 노드 버전을 지정하세요.
package.json 파일을 열고 언급된 모듈의 요구 사항을 지원하도록 최신 Node.js LTS 버전을 지정하세요.
package.json의 엔진 디렉티브에서 노드 버전을 지정할 수 있습니다.

VS Code에서 프로젝트의 package.json 파일을 연 다음, 패키지.json 파일에서 맨 처음 나오는 중괄호 바로 뒤에 engines 지시문을 추가하면 됩니다:

    {
        "engines": {
        "node": "18.13.0"
        },
        // and the remainder of your package.json content goes here

package.json 파일의 나머지 부분은 변경하지 않아야 합니다.

그런 다음 패키지.json 파일에 파일 변경 사항을 저장합니다.
그런 다음 코드를 git add/commit하고 다시 푸시한 다음 Render를 사용하여 배포를 다시 구축할 수 있습니다.


# 3.

Render는 앱 배포 프로세스에 GitHub를 사용합니다. Render를 통해 배포 프로세스를 완료하려면 Git과 GitHub를 사용해야 합니다(아래 지침 참조).
따라서 애플리케이션에 대한 Git 저장소를 생성한 다음 이를 GitHub에 푸시해야 하며, 그러면 Render가 이를 사용하여 플랫폼에 앱을 성공적으로 배포할 수 있습니다.
여기에서 Git 및 GitHub에 대해 배우려면 Colt의 유투브 튜토리얼을 살펴보세요:

- Colt의 Git 튜토리얼 : https://www.youtube.com/watch?v=USjZcfj8yxE
- Colt의 GitHub 튜토리얼 : https://www.youtube.com/watch?v=nhNq2kIvi9s

그런 다음 이 지침에 따라 YelpCamp에서 Git 저장소를 설정하고 해당 단계를 사용하여 앱을 GitHub에 푸시하세요.
YelpCamp용 Git 저장소 설정을 시작하기 전에 먼저 아래의 중요 참고 사항을 읽어 보세요:

git init커맨드로 Git 프로젝트 리포지토리를 생성한 후(위의 튜토리얼에서 배울 수 있음), 첫 번째 Git 커밋을 하기 전에 메인 프로젝트 폴더(app.js 및 package.json 파일 옆)에 다음과 같이 정확한 파일 이름으로 새 파일을 만들어야 합니다:
.gitignore (다시 말하지만, 파일 이름은 시작 점을 포함하여 여기에 지정된 대로 정확하게 지정해야 합니다.)
그런 다음 새로 만든 .gitignore 파일을 열고 아래 두 줄을 정확히 입력하여 추가합니다:

    node_modules/
    .env

파일 변경 사항을 저장한 다음 YelpCamp 프로젝트 Git 리포지토리에 대한 첫 번째 Git 커밋을 진행할 수 있습니다. 이렇게 하면 비공개 데이터가 있는 node_modules 폴더와 .env 파일의 불필요한 커밋을 방지할 수 있습니다(이에 대한 자세한 설명은 아래에서 확인할 수 있습니다).

일반적인 조언 사항 :
Git 리포지토리를 실험하기 전에, 특히 잘 모르는 Git 명령을 사용하기 전에 모든 코드 파일의 사본을 만들어 보조 위치에 백업해 두세요.
GitHub로 푸시할 때 리포지토리를 비공개로 설정하여 공개적으로 표시되지 않도록 할 수 있으며, 비공개 GitHub 리포지토리를 사용하여 배포할 수 있도록 Render에 권한을 부여할 수도 있습니다.

어떤 이유로든 GitHub에서 리포지토리를 공개하려는 경우 아래 참고 사항을 반드시 읽어 보세요:

GitHub에 배포할 때 중요한 보안 사항입니다: 코드를 GitHub에 푸시하고 '공개'를 선택하면 모든 사람이 코드를 볼 수 있습니다. 비밀번호, 비밀 키, 공개적으로 공유하고 싶지 않은 개인 데이터 등 민감한 데이터가 포함되어 있지 않은지 확인하세요. 이러한 데이터를 GitHub에 공개적으로 푸시하면 개인 데이터가 손상되어 모든 사람과 공유될 수 있으므로 코드에 민감한 데이터가 포함되어 있지 않은지 확인하세요. 하지만 GitHub 리포지토리가 '비공개'로 설정되어 있더라도 비공개/비밀 데이터를 추가하지 않는 동일한 원칙을 지켜야 합니다. 프로젝트 리포지토리에 비공개 데이터가 포함된 과거 Git 커밋이 있는 경우, .gitignore 방식을 사용한 후에도 이 데이터에 액세스할 수 있습니다. 온라인(Google을 통해)에서 Git 및 GitHub 보안에 대해 조사하고, Git 리포지토리 코드에 비밀번호나 키와 같은 비공개 데이터를 공유하지 않도록 하세요(비공개 데이터를 사용하여 과거에 커밋한 적이 있는 경우, Git 커밋 기록에서 비공개 데이터를 삭제하는 방법도 알아보세요).

예를 들어, dotenv 모듈을 사용 중이고 프로젝트에 .env 파일이 있는 경우 Git의 .gitignore 기능을 사용하여 (비밀 데이터가 포함된) .env 파일을 Git 리포지토리에 추가하거나 커밋하지 않도록 하여 GitHub에 푸시하지 않도록 해야 합니다.
.env 파일을 .gitignore 하는 방법 :
https://stackoverflow.com/questions/30696930/how-to-hide-env-file-from-github/30697067#30697067

또한 앱이 Render에 배포될 때 모듈 문제를 일으키지 않도록 앱의 node_modules 폴더도 커밋하지 않도록 하세요.


# 4.

Render에 가입하면 계정 대시보드에 액세스할 수 있습니다.


# 5.

Render 계정 대시보드에서 페이지 오른쪽 상단의 탐색 모음에 있는 New +  버튼을 클릭하고 Web Service 옵션을 선택합니다.
GitHub 계정을 Render 계정에 연결하지 않은 경우 지금 연결해야 하며, 배포하려는 GitHub 리포지토리를 사용할 수 있도록 Render에 권한을 부여해야 합니다.


# 6.

Render가 GitHub를 사용할 수 있는 권한이 부여되면 배포할 앱의 저장소를 선택하는 페이지로 이동합니다.
이 때 앞서 GitHub에 푸시한 YelpCamp 리포지토리를 선택합니다(앞서 언급했듯이 비공개 GitHub 리포지토리일 수도 있음).
목록에서 리포지토리를 찾으면 해당 리포지토리를 선택하고 Connect 버튼을 클릭합니다.


# 7.

Render에서 새 서비스를 만들 때 앱의 GitHub 리포지토리를 찾아 연결하면 배포 프로세스를 계속 진행하기 위해 작성해야 하는 양식으로 이동하게 됩니다.
이 양식에서 다음 필드를 작성해야 합니다:

이름 (Name): 배포된 앱의 간단한 이름을 선택합니다. 참고: 이름 값은 애플리케이션이 배포될 때 받게 되는 애플리케이션 URL에 영향을 줍니다.
지역 (Region): 기본 설정에 따라 앱이 호스팅될 지역을 선택합니다.
브랜치 (Branch): 배포에 사용할 Git 브랜치를 선택합니다
(예: 메인 브랜치, 마스터 브랜치 또는 배포를 위해 설정한 다른 브랜치 등 앞서 Git 및 GitHub 지침을 따를 때 설정한 브랜치).
환경/런타임 (Environment/Runtime): Node
빌드 커맨드 (Build Command): npm install
시작 커맨드 (Start Command): node app.js

그 아래에서 배포한 앱의 무료 요금제를 선택합니다. 여기에서 Render의 무료 요금제에 대해 자세히 알아볼 수 있습니다: here.

그 아래(같은 페이지)에서 Advanced  버튼을 클릭하여 몇 가지 고급 옵션을 확인할 수 있습니다.
이 옵션을 변경할 필요는 없지만 자동 배포 옵션을 'Yes'로 설정하면 새 코드를 GitHub의 리포지토리에 푸시할 때 자동으로 배포를 시도합니다.
배포에 적합하지 않은 앱 코드 업데이트를 GitHub에 푸시하면 배포된 앱이 손상될 수 있습니다.
Render의 배포된 앱 페이지에서 '아니요'를 선택하여 배포를 수동으로 처리할 수 있으며,
이는 앱 업데이트를 적용하고 GitHub 저장소에 푸시할 때 재디플로이 프로세스를 보다 안전하게 제어할 수 있는 옵션입니다.


# 8.

모든 설정이 완료되면 마지막으로 페이지 하단의 Create New Service 버튼을 클릭하면 됩니다.


# 9.

여기에서 앱 배포 프로세스의 로그를 보여주는 페이지로 리디렉션됩니다.

참고: 앱/프로젝트의 "노드" 엔진 버전을 설정해야 하는 것과 관련된 오류가 발생하면
#2.로 돌아가 지침에 따라 설정하세요. (아직 설정하지 않은 경우)

현재로서는 렌더링에서 앱의 환경 변수를 설정해야 하므로 YelpCamp 앱 배포가 실패할 것입니다.
이 문제를 해결하려면 아래 단계를 계속 진행하세요.


# 10.

렌더링의 앱 페이지에서 왼쪽 메뉴에서 Environment 옵션을 찾아 클릭합니다.
해당 페이지에서 애플리케이션에 대한 Environment Variables를 추가할 수 있습니다.


# 11.

환경 변수 추가 버튼을 클릭하여 애플리케이션에 새 환경 변수를 하나씩 추가하세요.
이 버튼을 계속 클릭하면 애플리케이션의 모든 환경 변수를 추가할 수 있습니다.
우리 강의에서 생성하는 코스 YelpCamp 앱의 경우, 이 환경 변수(키)를 정의해야 할 것입니다:

DB_URL — MongoDB Atlas 데이터베이스 링크로 설정합니다.
SECRET — 임의의 값을 선택합니다(복잡하게 설정하세요!).
MAPBOX_TOKEN —Mapbox 토큰으로 설정합니다.
CLOUDINARY_CLOUD_NAME — Cloudinary 클라우드 이름으로 설정합니다.
CLOUDINARY_KEY — Cloudinary 키로 설정합니다.
CLOUDINARY_SECRET — Cloudinary secret으로 설정합니다.


# 12.

이제 거의 다 끝나갑니다. 이제 MonogDB Atlas 데이터베이스 구성이 필요합니다!

Render에 앱을 배포할 때 브라우저의 Render 앱 대시보드에서 인터페이스 오른쪽 상단의 'Connect' 버튼을 클릭하면 배포된 애플리케이션이 사용할 정적 IP('정적 아웃바운드 IP 주소')를 찾을 수 있습니다. 여기에서 앱의 IP 주소를 복사하여 나중에 사용할 수 있도록 컴퓨터의 텍스트 파일이나 메모에 저장합니다.

반면에, MongoDB Atlas 구성에서는 MongoDB Atlas 데이터베이스에 연결할 수 있는 IP를 구성해야 합니다.

따라서 MongoDB Atlas 계정에 로그인하고 브라우저에서 MongoDB Atlas 클러스터 대시보드로 이동합니다(혹시 아직 MongoDB Atlas 클러스터/데이터베이스를 생성하지 않았다면 이 섹션의 시작 부분의 동영상 강의를 따라 생성하세요). MongoDB Atlas 클러스터 대시보드의 왼쪽 사이드바에서 '네트워크 액세스' 옵션을 찾습니다.

이 네트워크 액세스 인터페이스를 로드하면 페이지 오른쪽 상단에서 '+ ADD IP ADDRESS' 버튼을 찾아 앞서 렌더 앱 대시보드에서 복사한 각 렌더 앱 IP 주소를 추가합니다.

참고: 모든 IP를 허용하여 모든 곳에서 MongoDB Atlas 데이터베이스에 액세스할 수 있도록 선택할 수도 있습니다. 이 방법도 가능하지만, 배포된 앱이 사용할 정확한 정적 IP를 Render에서 제공하므로 이를 사용하여 추가 데이터베이스 액세스 보안을 위해 해당 IP만 특별히 허용할 수 있습니다.


# 13.

그 후 모든 것을 올바르게 잘 따라오셨다면, 배포된 앱이 잘 작동하는 것을 확인하실 수 있을 것입니다!
Render의 앱 페이지 상단에 있는 앱 링크를 찾아서 테스트해 보세요!
문제가 발생하면 Render 앱 대시보드의 'Logs' 페이지에서 확인할 수 있습니다.

